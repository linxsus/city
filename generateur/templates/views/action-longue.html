<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }} - G√©n√©rateur de Classes</title>
    <link rel="stylesheet" href="/static/css/main.css">
    <link rel="stylesheet" href="/static/css/blockly.css">
    <!-- Blockly -->
    <script src="https://unpkg.com/blockly/blockly_compressed.js"></script>
    <script src="https://unpkg.com/blockly/blocks_compressed.js"></script>
    <script src="https://unpkg.com/blockly/python_compressed.js"></script>
    <script src="https://unpkg.com/blockly/msg/fr.js"></script>
</head>
<body>
    {% include "partials/header.html" %}

    <main class="container-fluid">
        <div class="page-header">
            <h1>Cr√©er une ActionLongue</h1>
            <p>Construisez visuellement une s√©quence d'actions complexe avec des structures de contr√¥le</p>
        </div>

        <div class="action-longue-layout">
            <!-- Panneau de configuration -->
            <aside class="config-panel">
                <section class="form-section">
                    <h2>Configuration</h2>

                    <div class="form-group">
                        <label for="nom">Nom de l'action <span class="required">*</span></label>
                        <input type="text" id="nom" name="nom" required
                               pattern="^[a-z][a-z0-9_]*$"
                               placeholder="ex: collecter_ressources"
                               title="Lettres minuscules, chiffres et underscores uniquement">
                    </div>

                    <div class="form-group">
                        <label for="etat-requis">√âtat requis</label>
                        <select id="etat-requis" name="etat_requis">
                            <option value="">Aucun (facultatif)</option>
                            <!-- Rempli dynamiquement -->
                        </select>
                        <small class="form-help">L'√©tat dans lequel le manoir doit √™tre pour ex√©cuter cette action</small>
                    </div>

                    <div class="form-group">
                        <label for="description">Description</label>
                        <textarea id="description" name="description" rows="2"
                                  placeholder="Description de cette action..."></textarea>
                    </div>
                </section>

                <section class="form-section">
                    <h2>Actions rapides</h2>
                    <div class="quick-actions">
                        <button type="button" class="btn btn-secondary btn-small" id="btn-clear">
                            üóëÔ∏è Effacer tout
                        </button>
                        <button type="button" class="btn btn-secondary btn-small" id="btn-undo">
                            ‚Ü©Ô∏è Annuler
                        </button>
                        <button type="button" class="btn btn-secondary btn-small" id="btn-redo">
                            ‚Ü™Ô∏è Refaire
                        </button>
                    </div>
                </section>

                <section class="form-section">
                    <h2>Pr√©visualisation</h2>
                    <button type="button" class="btn btn-secondary" id="btn-preview">
                        G√©n√©rer le code
                    </button>
                    <pre class="code-preview-small" id="code-preview"><code>// Construisez votre action...</code></pre>
                </section>

                <section class="form-actions-vertical">
                    <button type="button" class="btn btn-primary btn-large" id="btn-generate">
                        üíæ G√©n√©rer et sauvegarder
                    </button>
                </section>
            </aside>

            <!-- Zone Blockly -->
            <div class="blockly-container">
                <div id="blockly-div"></div>
            </div>
        </div>

        <!-- Modal r√©sultat -->
        <div class="modal hidden" id="result-modal">
            <div class="modal-content modal-large">
                <h3 id="result-title">R√©sultat</h3>
                <div id="result-body"></div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-primary" onclick="closeModal()">Fermer</button>
                </div>
            </div>
        </div>
    </main>

    {% include "partials/footer.html" %}

    <!-- Blocs personnalis√©s -->
    <script src="/static/js/blockly/blocks/action-blocks.js"></script>
    <script src="/static/js/blockly/blocks/control-blocks.js"></script>
    <script src="/static/js/blockly/blocks/condition-blocks.js"></script>
    <script src="/static/js/blockly/blocks/variable-blocks.js"></script>

    <!-- G√©n√©rateur Python -->
    <script src="/static/js/blockly/generators/python.js"></script>

    <!-- Configuration toolbox -->
    <script src="/static/js/blockly/toolbox.js"></script>

    <!-- Application -->
    <script src="/static/js/api.js"></script>
    <script src="/static/js/app.js"></script>
    <script src="/static/js/views/action-longue-view.js"></script>
</body>
</html>
